<!DOCTYPE>
<htmnl>
<head>
	<title>Music App</title>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
</head>
<body>
	<div class='container-fluid'>
		<div class='page-header'>
			<h2>Web Audio Api Widgets</h2>
		</div>
		<p>Let's get started!</p>


		<div class='container-fluid'>
			<div class='page-header'>
				<h4>Oscillator Node</h4>
			</div>

			<!-- <div class='container-fluid well'> -->
			<div class='row well'>
				<div class='col-xs-3'>
					<p>Toggle Oscillator Node</p>
					<button id='start' type='button' class='btn btn-primary'>Start</button>
					<button id='stop' type='button' class='btn btn-default'>Stop</button>
				</div>
				<div class='col-xs-3'>
					<span>Adjust Frequency</span>
					<input id='slider' type='range' min='0' max='5000' onchange='update(this.value)' defaultVAlue='2500' step='5'>
					<div><span id='sliderVal'></span> Hz</div>
				</div>
				<div class='col-xs-3'>
					<span>Detune</span>
					<input id='detuner' type='range' min='0' max='1000' onchange='detune(this.value)' defaultVAlue='2500' step='5'>
					<div><span id='detuneVal'></span> </div>
				</div>
				<div class='col-xs-3'>
					<span>Change Type</span>
					<select id='type'>
						<option value='sine'>sine</option>
						<option value='square'>square</option>
						<option value='sawtooth'>sawtooth</option>
						<option value='triangle'>triangle</option>
						<option value='custom'>custom</option>
					</select>
				</div>
			</div>
			<!-- </div> -->
		</div>
	</div>


	<!-- This is main script -->
	<script>
		var audioCtx = new (window.AudioContext ||window.webkitAudioContext)();
		var distortion = audioCtx.createWaveShaper();

		// var buffer = null;

		// var request = new XMLHttpRequest();
		// request.responseType = 'arraybuffer';

		// request.onload = function(){
		// 	// create buffer here
		// };

		// request.open('GET', '"The Fool On The Hill.".mp3', true);

		// var mp3Source = audioCtx.createBufferSource();
		// source.buffer = buffer;

	</script>
	<script>
		var oscillator = audioCtx.createOscillator();
		oscillator.connect(audioCtx.destination);

		$('#start').click(function(){oscillate(true)});
		$('#stop').click(function(){oscillate(false)});
		$('#type').change(function(){updateType()});

		$('#slider').val(oscillator.frequency.value);
		update(oscillator.frequency.value);

		$('#detuner').val(oscillator.detune.value);
		detune(oscillator.detune.value);

		$('#type').val(oscillator.type);

		function update(val){
			printVal(val);
			oscillator.frequency.value = val;
		};

		function updateType(){
			oscillator.type = $('#type').val();
		};

		function detune(val){
			writeDetuneVal(val);
			oscillator.detune.value = val;
		};

		function printVal(val){
			$('#sliderVal').text(val);
		};

		function writeDetuneVal(val){
			$('#detuneVal').text(val);
		};

		function oscillate(oscillate){
			if (oscillate){
				if (oscillator == null){
					oscillator = audioCtx.createOscillator();
					oscillator.connect(audioCtx.destination);
				}
				console.log('Starting oscillator...');
				oscillator.start(0);
			} else {
				console.log('stopping oscillator...');
				oscillator.stop();
				oscillator = null;
			}
		};
	</script>
	<!-- -------------------------------------------------------------------------- -->

	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
</body>
</html>